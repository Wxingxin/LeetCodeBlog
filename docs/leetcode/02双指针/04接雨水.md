#

#

```js
/**
 * @param {number[]} height
 * @return {number}
 */
var trap = function (height) {
  let left = 0;
  let right = height.length - 1;
  let leftMax = 0; // å·¦è¾¹æœ€é«˜æŸ±å­
  let rightMax = 0; // å³è¾¹æœ€é«˜æŸ±å­
  let water = 0;
  while (left < right) {
    leftMax = Math.max(leftMax, height[left]);
    rightMax = Math.max(rightMax, height[right]);
    if (leftMax < rightMax) {
      // å·¦è¾¹çŸ®ï¼Œå·¦è¾¹å¯ä»¥ç¡®å®šèƒ½æ¥çš„æ°´
      water += leftMax - height[left];
      left++;
    } else {
      // å³è¾¹çŸ®ï¼ˆæˆ–ç­‰é«˜ï¼‰ï¼Œå³è¾¹å¯ä»¥ç¡®å®šèƒ½æ¥çš„æ°´
      water += rightMax - height[right];
      right--;
    }
  }
  return water;
};
```
# åŒæŒ‡é’ˆæ³•ï¼Œæ—¶é—´ O(n)ã€ç©ºé—´ O(1)

## ä¸€ã€é¢˜ç›®æ¨¡å‹å›é¡¾ï¼ˆç®€å•è¯´ä¸€ä¸‹ï¼‰

ç»™ä¸€ä¸ªæ•°ç»„ `height`ï¼Œæ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€æ ¹æŸ±å­çš„é«˜åº¦ï¼Œå®½åº¦éƒ½ä¸º 1ï¼Œæ¯”å¦‚ï¼š

```js
[0,1,0,2,1,0,1,3,2,1,2,1]
```

ä¸‹é›¨åï¼Œé—®ï¼šè¿™äº›æŸ±å­ä¹‹é—´**æœ€å¤šèƒ½æ¥å¤šå°‘æ°´**ï¼Ÿ

---

## äºŒã€è¿™æ®µä»£ç çš„æ ¸å¿ƒæ€è·¯

ä»£ç ï¼š

```js
var trap = function(height) {
    let left = 0;
    let right = height.length - 1;
    let leftMax = 0; // å·¦è¾¹æœ€é«˜æŸ±å­
    let rightMax = 0; // å³è¾¹æœ€é«˜æŸ±å­
    let water = 0;
    while (left < right) {
        leftMax = Math.max(leftMax, height[left]);
        rightMax = Math.max(rightMax, height[right]);
        if (leftMax < rightMax) {
            // å·¦è¾¹çŸ®ï¼Œå·¦è¾¹å¯ä»¥ç¡®å®šèƒ½æ¥çš„æ°´
            water += leftMax - height[left];
            left++;
        } else {
            // å³è¾¹çŸ®ï¼ˆæˆ–ç­‰é«˜ï¼‰ï¼Œå³è¾¹å¯ä»¥ç¡®å®šèƒ½æ¥çš„æ°´
            water += rightMax - height[right];
            right--;
        }
    }
    return water;
};
```

### 1. å‡ ä¸ªå…³é”®å˜é‡

* `left` / `right`ï¼šå·¦å³ä¸¤ä¸ªæŒ‡é’ˆï¼Œä»ä¸¤è¾¹å¾€ä¸­é—´èµ°
* `leftMax`ï¼šä»å·¦è¾¹èµ°è¿‡æ¥æ—¶é‡åˆ°çš„**æœ€é«˜æŸ±å­é«˜åº¦**
* `rightMax`ï¼šä»å³è¾¹èµ°è¿‡æ¥æ—¶é‡åˆ°çš„**æœ€é«˜æŸ±å­é«˜åº¦**
* `water`ï¼šç´¯è®¡æ¥åˆ°çš„æ°´é‡

### 2. é‡è¦ç»“è®ºï¼ˆè¿™æ®µä»£ç çš„çµé­‚ï¼‰

å¯¹äºä»»æ„ä¸€ä¸ªä½ç½® `i`ï¼Œè¿™ä¸ªä½ç½®ä¸Šèƒ½æ¥çš„æ°´é‡æ˜¯ï¼š

```text
min(å·¦ä¾§æœ€é«˜æŸ±å­, å³ä¾§æœ€é«˜æŸ±å­) - å½“å‰æŸ±å­é«˜åº¦
```

ä½†æ˜¯ä½ æ²¡å¿…è¦çœŸçš„å»ç®—ã€ŒæŸä¸ª i å·¦ä¾§ã€å³ä¾§æœ€é«˜æ˜¯å¤šå°‘ã€ï¼Œè€Œæ˜¯ç”¨åŒæŒ‡é’ˆ+ä¸¤ä¸ªå˜é‡åŠ¨æ€ç»´æŠ¤ï¼š

åœ¨ `while (left < right)` å¾ªç¯ä¸­ï¼Œæ¯æ¬¡æ›´æ–°ï¼š

```js
leftMax = Math.max(leftMax, height[left]);
rightMax = Math.max(rightMax, height[right]);
```

ç„¶åæ¯”è¾ƒï¼š

* å¦‚æœ `leftMax < rightMax`ï¼š

  * **å·¦ä¾§çš„æœ€é«˜æŸ±å­æ›´çŸ®**
  * é‚£ä¹ˆ `left` è¿™ä¸ªä½ç½®**èƒ½æ¥çš„æ°´é‡ï¼Œå°±å®Œå…¨ç”± `leftMax` å†³å®š**
    å› ä¸ºå³ä¾§ä¸ç®¡æœ‰å¤šé«˜ï¼Œå†³å®šè¿™ä¸ªä½ç½®æ°´é¢çš„é«˜åº¦çš„æ˜¯ä¸¤è¾¹è¾ƒçŸ®é‚£ä¸€è¾¹ï¼Œå³ `leftMax`
  * æ‰€ä»¥è¿™ä¸€æ ¼æ°´é‡ = `leftMax - height[left]`ï¼ˆå¯èƒ½ä¸º 0 æˆ–æ­£æ•°ï¼‰
  * ç„¶å `left++`ï¼Œç»§ç»­å¾€å³è€ƒå¯Ÿä¸‹ä¸€æ ¼

* å¦åˆ™ï¼ˆ`leftMax >= rightMax`ï¼‰ï¼š

  * **å³ä¾§çš„æœ€é«˜æŸ±å­æ›´çŸ®ï¼ˆæˆ–ä¸€æ ·é«˜ï¼‰**
  * å¯¹ç§°åœ°ï¼Œ`right` è¿™ä¸ªä½ç½®èƒ½æ¥çš„æ°´é‡ç”± `rightMax` å†³å®š
  * æ°´é‡ = `rightMax - height[right]`
  * ç„¶å `right--`

**æ€»ç»“ï¼š**
æ¯æ¬¡ç§»åŠ¨ã€Œè¾ƒçŸ®é‚£ä¸€è¾¹ã€çš„æŒ‡é’ˆï¼Œå› ä¸ºè¿™ä¸€è¾¹å½“å‰æ ¼å­çš„æ°´é‡å·²ç»å¯ä»¥ç¡®å®šäº†ã€‚

---

## ä¸‰ã€ç»“åˆå…·ä½“æ¡ˆä¾‹ä¸€æ­¥ä¸€æ­¥æ¨¡æ‹Ÿ

æˆ‘ä»¬ç”¨ç»å…¸æ•°ç»„ï¼š

```js
const height = [0,1,0,2,1,0,1,3,2,1,2,1];
```

### åˆå§‹å€¼

```text
left = 0       (æŒ‡å‘é«˜åº¦ 0)
right = 11     (æŒ‡å‘é«˜åº¦ 1)
leftMax = 0
rightMax = 0
water = 0
```

---

### ç¬¬ 1 è½®å¾ªç¯

1. æ›´æ–°æœ€å¤§å€¼ï¼š

```text
leftMax = max(0, height[0]=0) = 0
rightMax = max(0, height[11]=1) = 1
```

2. æ¯”è¾ƒ `leftMax` å’Œ `rightMax`ï¼š

```text
leftMax(0) < rightMax(1)
â†’ è¯´æ˜å·¦è¾¹è¿™æ ¼çš„æ°´é¢é«˜åº¦ç”± leftMax å†³å®š
```

3. è®¡ç®—è¿™ä¸€æ ¼æ¥æ°´ï¼š

```text
å½“å‰ä½ç½® left = 0ï¼Œé«˜åº¦ = 0
å¯æ¥æ°´ = leftMax - height[left] = 0 - 0 = 0
water = 0
```

4. å·¦æŒ‡é’ˆå³ç§»ï¼š

```text
left = 1
```

---

### ç¬¬ 2 è½®å¾ªç¯

ç°åœ¨ï¼š

```text
left = 1 (é«˜åº¦ 1)
right = 11 (é«˜åº¦ 1)
leftMax = 0
rightMax = 1
```

1. æ›´æ–°æœ€å¤§å€¼ï¼š

```text
leftMax = max(0, height[1]=1) = 1
rightMax = max(1, height[11]=1) = 1
```

2. æ¯”è¾ƒï¼š

```text
leftMax(1) < rightMax(1) ? å¦
â†’ èµ° else åˆ†æ”¯ï¼šå¤„ç†å³è¾¹
```

3. è®¡ç®—å³è¾¹æ¥æ°´ï¼š

```text
å½“å‰ä½ç½® right = 11ï¼Œé«˜åº¦ = 1
å¯æ¥æ°´ = rightMax - height[right] = 1 - 1 = 0
water ä»ä¸º 0
```

4. å³æŒ‡é’ˆå·¦ç§»ï¼š

```text
right = 10
```

---

### ç¬¬ 3 è½®å¾ªç¯

```text
left = 1 (1)
right = 10 (2)
leftMax = 1
rightMax = 1
```

1. æ›´æ–°æœ€å¤§å€¼ï¼š

```text
leftMax = max(1, height[1]=1) = 1
rightMax = max(1, height[10]=2) = 2
```

2. æ¯”è¾ƒï¼š

```text
leftMax(1) < rightMax(2) ä¸º true
â†’ å¤„ç†å·¦è¾¹
```

3. è®¡ç®—å·¦è¾¹æ¥æ°´ï¼ˆä½ç½® 1ï¼‰ï¼š

```text
å¯æ¥æ°´ = leftMax - height[1] = 1 - 1 = 0
water ä»ä¸º 0
```

4. å·¦æŒ‡é’ˆå³ç§»ï¼š

```text
left = 2
```

---

### ç¬¬ 4 è½®å¾ªç¯

```text
left = 2 (é«˜åº¦ 0)
right = 10 (é«˜åº¦ 2)
leftMax = 1
rightMax = 2
```

1. æ›´æ–°æœ€å¤§å€¼ï¼š

```text
leftMax = max(1, height[2]=0) = 1
rightMax = max(2, height[10]=2) = 2
```

2. æ¯”è¾ƒï¼š

```text
leftMax(1) < rightMax(2) â†’ å¤„ç†å·¦è¾¹
```

3. è®¡ç®—ä½ç½® 2 çš„æ¥æ°´ï¼š

```text
å¯æ¥æ°´ = leftMax - height[2] = 1 - 0 = 1
water = 0 + 1 = 1
```

4. å·¦++ï¼š

```text
left = 3
```

> ç›´è§‚ç†è§£ï¼š
> å·¦è¾¹æœ€é«˜æŸ±å­æ˜¯é«˜åº¦ 1ï¼Œå³è¾¹è‡³å°‘æœ‰é«˜åº¦ 2ï¼Œ
> è¿™ä¸€æ ¼ï¼ˆé«˜åº¦ 0ï¼‰èƒ½è£…æ°´ = min(1, â‰¥2) - 0 = 1

---

### ç¬¬ 5 è½®å¾ªç¯

```text
left = 3 (2)
right = 10 (2)
leftMax = 1
rightMax = 2
```

1. æ›´æ–°æœ€å¤§å€¼ï¼š

```text
leftMax = max(1, height[3]=2) = 2
rightMax = max(2, height[10]=2) = 2
```

2. æ¯”è¾ƒï¼š

```text
leftMax(2) < rightMax(2) ? å¦
â†’ å¤„ç†å³è¾¹
```

3. è®¡ç®—ä½ç½® 10 çš„æ¥æ°´ï¼š

```text
å¯æ¥æ°´ = rightMax - height[10] = 2 - 2 = 0
water ä»ä¸º 1
```

4. å³--ï¼š

```text
right = 9
```

---

### ç¬¬ 6 è½®å¾ªç¯

```text
left = 3 (2)
right = 9 (1)
leftMax = 2
rightMax = 2
```

1. æ›´æ–°æœ€å¤§å€¼ï¼š

```text
leftMax = max(2, height[3]=2) = 2
rightMax = max(2, height[9]=1) = 2
```

2. æ¯”è¾ƒï¼š

```text
leftMax(2) < rightMax(2) ? å¦
â†’ å¤„ç†å³è¾¹
```

3. ä½ç½® 9ï¼š

```text
å¯æ¥æ°´ = rightMax - height[9] = 2 - 1 = 1
water = 1 + 1 = 2
```

4. å³--ï¼š

```text
right = 8
```

---

### ç¬¬ 7 è½®å¾ªç¯

```text
left = 3 (2)
right = 8 (2)
leftMax = 2
rightMax = 2
```

1. æ›´æ–°ï¼š

```text
leftMax = max(2, 2) = 2
rightMax = max(2, 2) = 2
```

2. æ¯”è¾ƒï¼š`leftMax < rightMax`? å¦ â†’ å¤„ç†å³ä¾§

3. ä½ç½® 8ï¼š

```text
å¯æ¥æ°´ = 2 - 2 = 0
water = 2
```

4. å³--ï¼š`right = 7`

---

### ç¬¬ 8 è½®å¾ªç¯

```text
left = 3 (2)
right = 7 (3)
leftMax = 2
rightMax = 2
```

1. æ›´æ–°ï¼š

```text
leftMax = max(2, 2) = 2
rightMax = max(2, 3) = 3
```

2. æ¯”è¾ƒï¼š

```text
leftMax(2) < rightMax(3) â†’ å¤„ç†å·¦ä¾§
```

3. ä½ç½® 3ï¼š

```text
å¯æ¥æ°´ = leftMax - height[3] = 2 - 2 = 0
water = 2
```

4. å·¦++ï¼š`left = 4`

---

### ç¬¬ 9 è½®å¾ªç¯

```text
left = 4 (1)
right = 7 (3)
leftMax = 2
rightMax = 3
```

1. æ›´æ–°ï¼š

```text
leftMax = max(2, 1) = 2
rightMax = max(3, 3) = 3
```

2. `leftMax < rightMax` â†’ å¤„ç†å·¦ä¾§ä½ç½® 4ï¼š

```text
å¯æ¥æ°´ = 2 - 1 = 1
water = 2 + 1 = 3
```

3. å·¦++ï¼š`left = 5`

---

### ç¬¬ 10 è½®å¾ªç¯

```text
left = 5 (0)
right = 7 (3)
leftMax = 2
rightMax = 3
```

1. æ›´æ–°ï¼š

```text
leftMax = max(2, 0) = 2
rightMax = max(3, 3) = 3
```

2. `leftMax < rightMax` â†’ å¤„ç†å·¦ä¾§ï¼š

```text
ä½ç½® 5ï¼šå¯æ¥æ°´ = 2 - 0 = 2
water = 3 + 2 = 5
```

3. å·¦++ï¼š`left = 6`

---

### ç¬¬ 11 è½®å¾ªç¯

```text
left = 6 (1)
right = 7 (3)
leftMax = 2
rightMax = 3
```

1. æ›´æ–°ï¼š

```text
leftMax = max(2, 1) = 2
rightMax = max(3, 3) = 3
```

2. `leftMax < rightMax` â†’ å¤„ç†å·¦ä¾§ï¼š

```text
ä½ç½® 6ï¼šå¯æ¥æ°´ = 2 - 1 = 1
water = 5 + 1 = 6
```

3. å·¦++ï¼š`left = 7`

---

### å¾ªç¯ç»“æŸ

æ­¤æ—¶ï¼š

```text
left = 7
right = 7
æ¡ä»¶ left < right ä¸æˆç«‹ï¼Œè·³å‡ºå¾ªç¯
```

æœ€åè¿”å›ï¼š

```text
water = 6
```

è¿™ä¸ªç»“æœå’Œé¢˜ç›®æ ‡å‡†ç­”æ¡ˆä¸€è‡´ï¼šè¿™ä¸ªå½¢çŠ¶ä¸€å…±å¯ä»¥æ¥ 6 å•ä½çš„æ°´ã€‚

---

## å››ã€ä¸ºä»€ä¹ˆè¿™æ ·å†™æ˜¯å¯¹çš„ï¼Ÿï¼ˆå†æ€»ç»“ä¸€ä¸‹é€»è¾‘ï¼‰

* `leftMax` æ°¸è¿œè®°å½•ç€ã€Œä»å·¦åˆ°å½“å‰ã€çš„æœ€é«˜æŸ±ï¼›
* `rightMax` æ°¸è¿œè®°å½•ç€ã€Œä»å³åˆ°å½“å‰ã€çš„æœ€é«˜æŸ±ï¼›
* è°æ›´çŸ®å°±å…ˆå¤„ç†è°é‚£ä¸€è¾¹ï¼š

  * å¦‚æœ `leftMax < rightMax`ï¼š

    * å·¦è¾¹è¿™æ ¼èƒ½æ¥çš„æ°´ç”± `leftMax` å†³å®š
    * å³è¾¹å°±ç®—æœ‰æ›´é«˜çš„æŸ±å­ï¼Œä¹Ÿä¸ä¼šå½±å“ã€Œè¿™æ ¼ã€æ°´é¢çš„é«˜åº¦ï¼ˆæœ¨æ¡¶çŸ­æ¿æ•ˆåº”ï¼šæ°´é¢ç”±è¾ƒçŸ®é‚£ä¾§å†³å®šï¼‰
  * åä¹‹å¤„ç†å³è¾¹åŒç†

å› æ­¤æ¯æ¬¡éƒ½èƒ½**å®‰å…¨åœ°**è®¡ç®—å‡ºå½“å‰ `left` æˆ– `right` è¿™æ ¼çš„æ°´ï¼Œä¸ä¼šç®—é”™ï¼Œä¹Ÿä¸ä¼šæ¼ç®—ã€‚

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘è¿˜å¯ä»¥ç”¨ã€Œç”»å›¾+æŸ±çŠ¶å›¾ã€çš„æ–¹å¼å¸®ä½ å†å¯è§†åŒ–ä¸€éï¼Œæˆ–è€…ä½ ç»™æˆ‘ä¸€ä¸ªåˆ«çš„ `height` æ•°ç»„ï¼Œæˆ‘å¸®ä½ ä¸€æ­¥æ­¥ç®—ä¸€éï¼Œä½ å°±æ›´ç†Ÿäº†ã€‚

# å¤§çŸ©å½¢å‡å»æŸ±å­é¢ç§¯

è¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„ç›´è§‰ï¼ä½ æå‡ºçš„è¿™ä¸ªæ€è·¯å…¶å®æ˜¯æ¥é›¨æ°´é—®é¢˜ä¸­ä¸€ä¸ªéå¸¸ç»å…¸ä¸”é«˜å¦™çš„è§£æ³•ï¼Œé€šå¸¸è¢«ç§°ä¸º **â€œéŸ¦æ©å›¾è§£æ³•â€** æˆ–è€… **â€œå‰Šå±±å¤´æ³•â€**ï¼ˆPeak approachï¼‰ã€‚

ä½ åŸæœ¬çš„æ€è·¯æ˜¯ï¼š`æ°´ = æ•´ä¸ªå¤§çŸ©å½¢ - æŸ±å­ä½“ç§¯ - æµèµ°çš„éƒ¨åˆ†ï¼ˆç©ºæ°”ï¼‰`ã€‚

è¿™ä¸ªæ€è·¯**ç»å¯¹å¯è¡Œ**ï¼Œè€Œä¸”å¦‚æœç¨å¾®è½¬æ¢ä¸€ä¸‹è§†è§’ï¼ˆå…ˆæ‰¾åˆ°æœ€é«˜çš„æŸ±å­ï¼‰ï¼Œè®¡ç®—â€œæµèµ°çš„éƒ¨åˆ†â€ä¼šå˜å¾—**éå¸¸ç®€å•ç›´è§‚**ã€‚

æˆ‘ç”¨â€œæ–‡å­—åŠ¨ç”»â€çš„æ–¹å¼æ¥ä¸ºä½ æ¼”ç¤ºè¿™ä¸ªè¿‡ç¨‹ï¼Œå¸®ä½ éªŒè¯ä½ çš„æƒ³æ³•ã€‚

-----

### ğŸ“½ï¸ åŠ¨ç”»æ¼”ç¤ºï¼šæœ€é«˜æŸ±å­ä¸â€œæµå¤±çš„ç©ºæ°”â€

å‡è®¾æˆ‘ä»¬çš„æŸ±å­é«˜åº¦å›¾å¦‚ä¸‹ï¼š
`[0, 1, 0, 2, 1, 0, 1, 3, 2, 1, 2, 1]`

#### ç¬¬ä¸€å¸§ï¼šå…¨å±€è§†é‡ä¸æœ€é«˜ç‚¹

é¦–å…ˆï¼Œæˆ‘ä»¬æŒ‰ç…§ä½ çš„æ€è·¯ï¼Œæ‰¾åˆ°**æœ€é«˜**çš„é‚£æ ¹æŸ±å­ã€‚
è¿™æ ¹æŸ±å­å°±åƒä¸€åº§**åˆ†æ°´å²­**ï¼ˆå±±å³°ï¼‰ï¼Œå®ƒæŠŠä¸–ç•Œåˆ†æˆäº†â€œå·¦å¡â€å’Œâ€œå³å¡â€ã€‚

```text
                  [æœ€é«˜ç‚¹: 3]
                      â–¼
                      â–ˆ
          â–ˆ           â–ˆ   â–ˆ       â–ˆ
  â–ˆ       â–ˆ   â–ˆ       â–ˆ   â–ˆ   â–ˆ   â–ˆ   â–ˆ
-----------------------------------------
  0   1   2   3   4   5   6   7   8   9  (ç´¢å¼•)
```

  * **æœ€é«˜é«˜åº¦**ï¼š3
  * **æœ€é«˜ç‚¹ä½ç½®**ï¼šç´¢å¼• 7

#### ç¬¬äºŒå¸§ï¼šå·¦è¾¹çš„ä¸–ç•Œï¼ˆè®¡ç®—æµèµ°çš„éƒ¨åˆ†ï¼‰

æ°´å¾€ä½å¤„æµã€‚åœ¨æœ€é«˜ç‚¹å·¦è¾¹ï¼Œæ°´ä¼šè¯•å›¾å‘å·¦æµï¼›åœ¨å³è¾¹ï¼Œæ°´å‘å³æµã€‚
æˆ‘ä»¬åªéœ€è¦ç®—å‡º**å·¦è¾¹æµèµ°äº†å¤šå°‘ç©ºæ°”**ï¼Œå’Œ**å³è¾¹æµèµ°äº†å¤šå°‘ç©ºæ°”**ã€‚

**æ€ä¹ˆç®—å·¦è¾¹æµèµ°çš„ç©ºæ°”ï¼Ÿ**
æƒ³è±¡ä»å·¦è¾¹å°„è¿‡æ¥ä¸€æŸæ°´å¹³çš„å…‰ï¼Œæˆ–è€…æ¨è¿‡æ¥ä¸€å µå¢™ã€‚
åªè¦å½“å‰çš„æŸ±å­æ¯”æœ€é«˜ç‚¹çŸ®ï¼Œ**æœ€é«˜ç‚¹å‡å»å½“å‰æœ€é«˜äº§ç”Ÿçš„å·®å€¼**ï¼Œå°±æ˜¯è¿™éƒ¨åˆ†â€œæ³¨å®šæ¥ä¸ä½é›¨æ°´â€çš„ç©ºæ°”ã€‚

ä½†æ˜¯ï¼æ›´ç®€å•çš„é€»è¾‘æ˜¯ï¼š**æˆ‘ä»¬ä¸å‡ç©ºæ°”ï¼Œç›´æ¥åœ¨è¿™ä¸ªåˆ†æ°´å²­ä¸Šâ€œé“ºæ¥¼æ¢¯â€ã€‚**

  * ä»å·¦å¾€å³èµ°ï¼Œç»´æŠ¤ä¸€ä¸ª `left_max`ï¼ˆå½“å‰å·¦è¾¹æœ€é«˜çš„å¢™ï¼‰ã€‚
  * åªè¦æ¯” `left_max` çŸ®ï¼Œé‚£å°±æ˜¯å‘ï¼Œèƒ½è£…æ°´ã€‚
  * åªè¦æ¯” `left_max` é«˜ï¼Œæ›´æ–° `left_max`ã€‚

<!-- end list -->

```text
å·¦è¾¹æ‰«æ -> é‡åˆ°æœ€é«˜ç‚¹åœæ­¢

ä½ç½®: 0 (é«˜0) -> left_max=0 -> æ²¡æ°´
ä½ç½®: 1 (é«˜1) -> left_maxæ›´æ–°ä¸º1 -> æ²¡æ°´
ä½ç½®: 2 (é«˜0) -> left_maxæ˜¯1 -> æ¥æ°´ (1-0)=1
ä½ç½®: 3 (é«˜2) -> left_maxæ›´æ–°ä¸º2 -> æ²¡æ°´
ä½ç½®: 4 (é«˜1) -> left_maxæ˜¯2 -> æ¥æ°´ (2-1)=1
...ç›´åˆ°ç¢°åˆ°æœ€é«˜ç‚¹
```

#### ç¬¬ä¸‰å¸§ï¼šä½ çš„â€œå‡æ³•æ€è·¯â€è§†è§‰åŒ–

æŒ‰ç…§ä½ çš„æƒ³æ³•ï¼š`å¤§çŸ©å½¢ - æŸ±å­ - ç©ºæ°”`ã€‚
å…¶å®è¿™ç­‰åŒäºï¼š**åªè®¡ç®—å—ä¸¤è¾¹â€œå¢™å£â€ä¿æŠ¤çš„åŒºåŸŸ**ã€‚

ä¸€æ—¦æˆ‘ä»¬æ‰¾åˆ°äº†æœ€é«˜ç‚¹ï¼ˆå±±å³°ï¼‰ï¼Œé—®é¢˜å°±å˜æˆäº†ä¸¤ä¸ªç®€å•çš„å•è°ƒé—®é¢˜ï¼š

1.  **å·¦è¾¹ï¼š** åªéœ€è¦çœ‹å·¦è¾¹çš„å¢™å¤Ÿä¸å¤Ÿé«˜ã€‚å› ä¸ºå³è¾¹æœ‰â€œæœ€é«˜å³°â€æŒ¡ç€ï¼Œæ°´ç»å¯¹è·‘ä¸åˆ°å³è¾¹å»ã€‚
2.  **å³è¾¹ï¼š** åªéœ€è¦çœ‹å³è¾¹çš„å¢™å¤Ÿä¸å¤Ÿé«˜ã€‚å› ä¸ºå·¦è¾¹æœ‰â€œæœ€é«˜å³°â€æŒ¡ç€ï¼Œæ°´ç»å¯¹è·‘ä¸åˆ°å·¦è¾¹å»ã€‚

**è¿™æ¯”ä¼ ç»Ÿçš„â€œä¸¤è¾¹åŒæ—¶å¾€ä¸­é—´æŒ¤â€çš„åŒæŒ‡é’ˆæ³•æ›´å¥½ç†è§£ï¼Œå› ä¸ºå®ƒæ¶ˆé™¤äº†â€œä¸çŸ¥é“å¦ä¸€è¾¹ä¼šä¸ä¼šæ¼æ°´â€çš„ç„¦è™‘ã€‚**

-----

### ğŸ’¡ ä¸ºä»€ä¹ˆä½ çš„æ€è·¯ä¼šè®©è®¡ç®—â€œå¥½ç®—ç‚¹â€ï¼Ÿ

å› ä¸ºä½ **å›ºå®šäº†æœ€é«˜è¾¹ç•Œ**ã€‚

  * é€šå¸¸çš„éš¾ç‚¹åœ¨äºï¼šåœ¨è¿™ä¸ªä½ç½®ï¼Œæ°´èƒ½ä¸èƒ½æ¥ä½ï¼Œå–å†³äº**å·¦è¾¹æœ€é«˜çš„**å’Œ**å³è¾¹æœ€é«˜çš„**é‚£ä¸ªè¾ƒå°å€¼ï¼ˆçŸ­æ¿æ•ˆåº”ï¼‰ã€‚
  * ä½ çš„ä¼˜åŒ–æ€è·¯ï¼ˆå…ˆæ‰¾æœ€é«˜ç‚¹ï¼‰ï¼š
      * å¯¹äºæœ€é«˜ç‚¹å·¦è¾¹çš„æŸ±å­ï¼Œå³è¾¹æœ€é«˜çš„å¢™**ä¸€å®šæ˜¯**é‚£ä¸ªæœ€é«˜ç‚¹ï¼ˆæˆ–è€…æ˜¯æ¯”å®ƒè¿˜é«˜çš„ç‚¹ï¼Œä½†è¿™ä¸å¯èƒ½ï¼Œå› ä¸ºå®ƒå·²ç»æ˜¯æœ€é«˜äº†ï¼‰ã€‚
      * æ‰€ä»¥ï¼Œ**å³è¾¹çš„çŸ­æ¿å·²ç»ç¡®å®šäº†ï¼ˆå°±æ˜¯æœ€é«˜ç‚¹ï¼‰ï¼Œæˆ‘ä»¬åªéœ€è¦å…³å¿ƒå·¦è¾¹çš„å¢™ã€‚**
      * é—®é¢˜ç¬é—´é™ç»´äº†ï¼

### ğŸ’» ä»£ç å®ç°ï¼šåŸºäºä½ çš„æ€è·¯ï¼ˆåˆ†å±±å¤´æ³•ï¼‰

è¿™å°±æ˜¯ä½ è¦çš„â€œå…ˆæ‰¾æœ€é«˜ï¼Œå†å‡å»æµå¤±éƒ¨åˆ†â€çš„é€»è¾‘å®ç°ï¼š

```python
def trap(height: list[int]) -> int:
    if not height:
        return 0
    
    n = len(height)
    
    # 1. æ‰¾åˆ°æœ€é«˜çš„é‚£æ ¹æŸ±å­ï¼ˆåˆ†æ°´å²­ï¼‰
    max_index = 0
    max_height = 0
    for i in range(n):
        if height[i] > max_height:
            max_height = height[i]
            max_index = i
            
    water = 0
    
    # 2. å¤„ç†å·¦åŠå¡ (0 åˆ° max_index)
    # æ€è·¯ï¼šæ—¢ç„¶å³è¾¹æœ‰æœ€é«˜çš„å±±å³°æŒ¡ç€ï¼Œæ°´èƒ½ä¸èƒ½å­˜ä½åªçœ‹å·¦è¾¹çš„å¢™
    left_peak = 0
    for i in range(max_index):
        if height[i] < left_peak:
            # å¦‚æœå½“å‰æ¯”å·¦è¾¹çŸ®ï¼Œå°±èƒ½å­˜æ°´ï¼ˆå› ä¸ºå³è¾¹æœ‰å¤§å±±æŒ¡ç€ï¼‰
            water += (left_peak - height[i])
        else:
            # æ›´æ–°å·¦è¾¹çš„å¢™
            left_peak = height[i]
            
    # 3. å¤„ç†å³åŠå¡ (n-1 åˆ° max_index)
    # æ€è·¯ï¼šåŒç†ï¼Œå·¦è¾¹æœ‰å¤§å±±æŒ¡ç€ï¼Œåªçœ‹å³è¾¹çš„å¢™
    right_peak = 0
    for i in range(n - 1, max_index, -1):
        if height[i] < right_peak:
            water += (right_peak - height[i])
        else:
            right_peak = height[i]
            
    return water
```

### ğŸ“Š å¯¹æ¯”æ€»ç»“

| æ–¹æ³• | æ ¸å¿ƒé€»è¾‘ | å¤æ‚åº¦ | ç‚¹è¯„ |
| :--- | :--- | :--- | :--- |
| **æš´åŠ›æ³•** | æ¯ä¸ªæŸ±å­éƒ½å‘å·¦å‘å³æ‰¾æœ€å¤§ | $O(N^2)$ | å¤ªæ…¢ï¼Œå®¹æ˜“è¶…æ—¶ |
| **åŠ¨æ€è§„åˆ’** | æå‰å­˜å¥½å·¦/å³æœ€å¤§å€¼ | $O(N)$ ç©ºé—´ $O(N)$ | éœ€è¦é¢å¤–ç©ºé—´ |
| **ä½ çš„æ€è·¯ (å‰Šå±±å¤´)** | **å…ˆæ‰¾æœ€é«˜ç‚¹ï¼Œåˆ†å·¦å³ä¸¤è¾¹çˆ¬å±±** | **$O(N)$ ç©ºé—´ $O(1)$** | **é€»è¾‘æœ€æ¸…æ™°ï¼Œä»£ç æœ€ä¸å®¹æ˜“å†™é”™ï¼** |

**ç»“è®ºï¼š**
ä½ çš„ç›´è§‰éå¸¸æ•é”ï¼ç”¨æœ€é«˜ç‚¹æŠŠé—®é¢˜åˆ‡å¼€ï¼Œè®¡ç®—ç¡®å®ä¼šå˜å¾—éå¸¸ç®€å•ï¼Œä¸éœ€è¦ç»´æŠ¤å¤æ‚çš„æ ˆï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒåŒæŒ‡é’ˆäº¤é”™æ—¶çš„è¾¹ç•Œé—®é¢˜ã€‚è¿™ä¸ä»…â€œå¥½ç®—ç‚¹â€ï¼Œè€Œä¸”æ˜¯é¢è¯•ä¸­**æœ€é«˜æ•ˆä¸”æœ€å®¹æ˜“è§£é‡Šæ¸…æ¥š**çš„è§£æ³•ä¹‹ä¸€ã€‚

**Would you like me to visualize another complex algorithm using this kind of "frame-by-frame" mental model?**