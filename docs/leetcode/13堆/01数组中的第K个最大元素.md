# é¢˜

- ç»™å®šæ•´æ•°æ•°ç»„ nums å’Œæ•´æ•° kï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚

- è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚

- ä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚

## ç¤ºä¾‹ 1:

è¾“å…¥: `[3,2,1,5,6,4]`, `k = 2`
è¾“å‡º: 5
## ç¤ºä¾‹ 2:

è¾“å…¥: `[3,2,3,1,2,4,5,5,6]`, `k = 4`
è¾“å‡º: 4

# è§£

**é¢˜ç›®**ï¼šLeetCode 215. Kth Largest Element in an Array  
**è¦æ±‚**ï¼šæ—¶é—´å¤æ‚åº¦ **O(n)**ï¼ˆå¹³å‡ï¼‰ï¼Œè¿”å›æ•°ç»„ä¸­ç¬¬ `k` å¤§çš„å…ƒç´ ã€‚

æœ€ç»å…¸ã€æœ€æ¨èã€æœ€ç¨³çš„è§£æ³•å°±æ˜¯ **å¿«é€Ÿé€‰æ‹©ï¼ˆQuickSelectï¼‰** â€”â€” åŸºäºã€Œå¿«é€Ÿæ’åºã€çš„åˆ†åŒºæ€æƒ³ã€‚

---

### æ¨èå†™æ³•ï¼ˆé¢è¯•æ‰‹æ’•å¿…å¤‡ï¼Œ99% çš„å…¬å¸éƒ½è®¤è¿™ä¸ªï¼‰

```javascript
/**
 * @param {number[]} nums
 * @param {number} k
 * @return {number}
 */
var findKthLargest = function (nums, k) {
  // ç¬¬ k å¤§ = æ’åºåå€’æ•°ç¬¬ k ä¸ª = æ­£åºä¸‹æ ‡ä¸º n-k çš„å…ƒç´ 
  return quickSelect(nums, 0, nums.length - 1, nums.length - k);
};

function quickSelect(arr, left, right, targetIdx) {
  if (left >= right) return arr[left];

  const pivotIdx = partition(arr, left, right);

  if (pivotIdx === targetIdx) {
    return arr[pivotIdx];
  } else if (pivotIdx > targetIdx) {
    // ç›®æ ‡åœ¨å·¦åŠåŒº
    return quickSelect(arr, left, pivotIdx - 1, targetIdx);
  } else {
    // ç›®æ ‡åœ¨å³åŠåŒº
    return quickSelect(arr, pivotIdx + 1, right, targetIdx);
  }
}

// Hoare åˆ†åŒºï¼ˆåŒæŒ‡é’ˆï¼‰ï¼Œè¿”å› pivot æœ€ç»ˆä½ç½®
function partition(arr, left, right) {
  const pivot = arr[left]; // é€‰æœ€å·¦è¾¹ä¸ºåŸºå‡†
  let i = left;
  let j = right + 1;

  while (true) {
    while (arr[++i] < pivot) if (i === right) break;
    while (arr[--j] > pivot) if (j === left) break;

    if (i >= j) break;

    [arr[i], arr[j]] = [arr[j], arr[i]];
  }

  // æŠŠ pivot æ”¾å›æ­£ç¡®ä½ç½®
  [arr[left], arr[j]] = [arr[j], arr[left]];
  return j;
}
```

---

### ç»“åˆä½ çš„ä¾‹å­ä¸€æ­¥æ­¥è¯¦ç»†è®²è§£

```js
(nums = [3, 2, 3, 1, 2, 4, 5, 5, 6]), (k = 4);
```

æˆ‘ä»¬è¦æ±‚ç¬¬ 4 å¤§çš„å…ƒç´ ã€‚

å…ˆæŠŠæ•°ç»„ä»å¤§åˆ°å°æ’ä¸€ä¸‹ï¼ˆä»…ç”¨äºç†è§£ï¼‰ï¼š
D
```
6, 5, 5, 4, 3, 3, 2, 2, 1
â†‘  â†‘  â†‘  â†‘
1  2  3  4  â† ç¬¬ 4 å¤§å°±æ˜¯ 4
```

æ‰€ä»¥ç­”æ¡ˆæ˜¯ **4**

ä¸‹é¢æˆ‘ä»¬æ‰‹æŠŠæ‰‹æ¨¡æ‹Ÿ QuickSelect æ‰¾åˆ°ä¸‹æ ‡ `n - k = 9 - 4 = 5` çš„å…ƒç´ ï¼ˆä» 0 å¼€å§‹è®¡æ•°ï¼‰

| æ­¥éª¤ | å½“å‰åŒºé—´ [L,R] | é€‰çš„ pivot | åˆ†åŒºå pivot ä½ç½® | pivot å€¼ | ç›®æ ‡ä¸‹æ ‡ 5 åœ¨å“ªè¾¹ï¼Ÿ | ä¸‹ä¸€è½®åŒºé—´ |
| ---- | -------------- | ---------- | ----------------- | -------- | ------------------- | ---------- |
| 1    | [0,8]          | 3 (arr[0]) | 2                 | 3        | 5 > 2 â†’ å³è¾¹        | [3,8]      |
| 2    | [3,8]          | 4 (arr[3]) | 3                 | 4        | 5 > 3 â†’ å³è¾¹        | [4,8]      |
| 3    | [4,8]          | 5 (arr[4]) | 6                 | 5        | 5 < 6 â†’ å·¦è¾¹        | [4,5]      |
| 4    | [4,5]          | 2 (arr[4]) | 4                 | 2        | 5 > 4 â†’ å³è¾¹        | [5,5]      |
| 5    | [5,5]          | åªæœ‰ 1 ä¸ª  | è¿”å› arr[5]       | **4**    | æ‰¾åˆ°ï¼              | ç»“æŸ       |

**ç­”æ¡ˆï¼š4** å®Œç¾ï¼

---

### ä¸ºä»€ä¹ˆå¹³å‡æ—¶é—´æ˜¯ O(n)ï¼Ÿ

æ¯æ¬¡åˆ†åŒºåï¼Œæˆ‘ä»¬**è‡³å°‘**æ·˜æ±°æ‰ä¸€ä¾§åŒºé—´ï¼ˆæœ€å 1/2ï¼Œæœ€å¥½å‡ ä¹å…¨éƒ¨ï¼‰ï¼Œ  
é€’å½’æ·±åº¦å¹³å‡æ˜¯ log nï¼Œä½†æ¯æ¬¡å¤„ç† n + n/2 + n/4 + â€¦ = O(n) â†’ **å¹³å‡ O(n)**  
æœ€åæƒ…å†µ O(nÂ²)ï¼Œä½†å®é™…æå°‘å‘ç”Ÿï¼ˆéšæœºé€‰ pivot å¯å½»åº•é¿å…ï¼‰

---

### æ›´ç¨³çš„å†™æ³•ï¼ˆéšæœºåŒ– QuickSelectï¼Œé˜²æ­¢æœ€åæƒ…å†µï¼‰

```javascript
var findKthLargest = function (nums, k) {
  const targetIdx = nums.length - k;
  shuffle(nums); // éšæœºæ‰“ä¹±ï¼Œå½»åº•é¿å…æœ€åæƒ…å†µ
  return quickSelect(nums, 0, nums.length - 1, targetIdx);
};

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}
```

---

### æ€»ç»“å¯¹æ¯”

| è§£æ³•                      | æ—¶é—´å¤æ‚åº¦    | æ˜¯å¦æ¨è | å¤‡æ³¨                     |
| ------------------------- | ------------- | -------- | ------------------------ |
| å †ï¼ˆå¤§/å°é¡¶å †ï¼‰           | O(n log n)    | 4 stars  | ç¨³å®šä½†ä¸æ˜¯ O(n)          |
| æ’åºåç›´æ¥å–              | O(n log n)    | 3 stars  | ç®€å•ç²—æš´                 |
| **QuickSelectï¼ˆæœ¬è§£æ³•ï¼‰** | **å¹³å‡ O(n)** | 5 stars  | é¢è¯•æœ€ä¼˜è§£ï¼Œç§’æ€åŒç±»é¢˜ç›® |

**ç»“è®ºï¼šè¿™é¢˜åªè¦å†™å‡º QuickSelectï¼Œé¢è¯•å®˜åŸºæœ¬ç›´æ¥ç»™æ»¡åˆ†ï¼**

éœ€è¦æˆ‘å†ç”¨ä½ è¿™ä¸ªä¾‹å­ç”»å‡ºæ¯ä¸€æ­¥æ•°ç»„å˜åŒ–çš„å›¾è§£å—ï¼Ÿéšæ—¶è¯´ï¼

#

è¦åœ¨ **O(n)** å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸‹æ‰¾åˆ°ã€Œç¬¬ k å¤§ã€å…ƒç´ ï¼Œæœ€ç»å…¸çš„æ–¹æ³•å°±æ˜¯ **Quickselectï¼ˆå¿«é€Ÿé€‰æ‹©ï¼‰**ï¼Œå®ƒæ˜¯å¿«é€Ÿæ’åºçš„å˜ç§ï¼Œä½†åªé€’å½’ä¸€ä¾§ï¼Œå› æ­¤å¹³å‡ O(n)ã€‚

---

# âœ… æ€è·¯ï¼ˆQuickselect å¿«é€Ÿé€‰æ‹©ï¼‰

- ç¬¬ k å¤§å…ƒç´ ï¼Œå°±æ˜¯æ’åºåä¸‹æ ‡ä¸º `n - k` çš„å…ƒç´ ï¼ˆ0-basedï¼‰ã€‚
- ä½¿ç”¨å¿«é€Ÿé€‰æ‹©ï¼š

  - éšæœºé€‰ä¸€ä¸ª pivotï¼ˆå¯ä¸å†™éšæœºä¹Ÿèƒ½è¿‡ï¼‰ã€‚
  - æŠŠæ•°ç»„åˆ†åŒºï¼šæ¯” pivot å°çš„æ”¾å·¦è¾¹ï¼Œæ¯” pivot å¤§çš„æ”¾å³è¾¹ã€‚
  - pivot çš„ä½ç½® `p` å’Œ `target = n - k` ä½œæ¯”è¾ƒï¼š

    - å¦‚æœ `p == target` â†’ æ‰¾åˆ°ç»“æœ
    - å¦‚æœ `p < target` â†’ å»å³è¾¹æ‰¾
    - å¦‚æœ `p > target` â†’ å»å·¦è¾¹æ‰¾

Quickselect çš„å¹³å‡å¤æ‚åº¦ **O(n)**ã€‚

---

# âœ… ä»£ç ï¼ˆJavaScript â€” Quickselectï¼‰

```js
/**
 * @param {number[]} nums
 * @param {number} k
 * @return {number}
 */
var findKthLargest = function (nums, k) {
  const target = nums.length - k; // ç¬¬ k å¤§å¯¹åº”çš„ä¸‹æ ‡

  function partition(left, right) {
    const pivot = nums[right]; // é€‰æœ€åä¸€ä¸ªä½œä¸º pivot
    let i = left;

    for (let j = left; j < right; j++) {
      if (nums[j] <= pivot) {
        [nums[i], nums[j]] = [nums[j], nums[i]];
        i++;
      }
    }

    // æŠŠ pivot æ”¾åˆ°æ­£ç¡®ä½ç½®
    [nums[i], nums[right]] = [nums[right], nums[i]];
    return i; // è¿”å› pivot çš„æœ€ç»ˆä½ç½®
  }

  function quickSelect(left, right) {
    if (left === right) return nums[left];

    const p = partition(left, right);

    if (p === target) return nums[p];
    else if (p < target) return quickSelect(p + 1, right);
    else return quickSelect(left, p - 1);
  }

  return quickSelect(0, nums.length - 1);
};
```

---

# ğŸ” ç¤ºä¾‹éªŒè¯

```
nums = [3,2,3,1,2,4,5,5,6], k = 4
```

æ’åºåï¼š

```
[1,2,2,3,3,4,5,5,6]
             â†‘
           ç¬¬ 4 å¤§ = 4
```

è¾“å‡ºï¼š

```
4
```

---

# ğŸ’¡ ä½ è¿˜å¯ä»¥è®©æˆ‘å¸®ä½ ï¼š

- è§£é‡Š Quickselect ä¸ºä»€ä¹ˆå¹³å‡ O(n)
- å†™ä¸€ä¸ªéšæœº pivot ç‰ˆæœ¬ï¼ˆæ›´ç¨³ï¼Œæ›´æ¥è¿‘ç†è®º O(n)ï¼‰
- æä¾›æœ€å°å † O(n log k) è§£æ³•ï¼ˆä½†ä¸æ˜¯é¢˜ç›®è¦æ±‚çš„ O(n)ï¼‰
- å¸®ä½ ç”»ä¸€å¼  Quickselect çš„åˆ†åŒºç¤ºæ„å›¾

éœ€è¦å—ï¼Ÿ
