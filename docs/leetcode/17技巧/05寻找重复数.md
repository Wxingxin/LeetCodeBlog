# 寻找重复数

给定一个包含 `n + 1 `个整数的数组 `nums` ，其数字都在 `[1, n]` 范围内（`包括 1 和 n`），可知至少存在一个重复的整数。

假设 `nums` 只有 一个重复的整数 ，返回 这个重复的数 。

你设计的解决方案必须 **不修改** 数组 `nums` 且只用常量级 `O(1)` 的额外空间。

## 示例 1：

输入：`nums = [1,3,4,2,2]`

输出：`2`

## 示例 2：

输入：`nums = [3,1,3,4,2]`

输出：`3`

## 示例 3 :

输入：`nums = [3,3,3,3,3]`

输出：`3`

# 解

这题（LeetCode 287）最符合要求的解法是：**把数组看成“链表”，用快慢指针找环入口**。
优点：**不修改数组 + O(1) 额外空间 + O(n) 时间**。

---

## 关键转化：数组为什么能当链表？

题目保证：

- `nums.length = n + 1`
- 每个值都在 `[1, n]`

所以对任意下标 `i`，`nums[i]` 都是一个合法的“下一个下标”（1..n）。
我们可以定义“指向关系”：

> `i -> nums[i]`

这样从 `0` 出发会一直走下去，因为下标只有有限个（0..n），**必然会出现重复走到某个位置**，这就形成了**环**。

而“环”出现的原因正是：**有一个数重复**，导致多个位置指向同一个“下一个下标”。

---

## 为什么“环入口”就是重复数字？

设重复数字是 `d`，意味着有至少两个不同下标 `a != b` 满足：

- `nums[a] = d`
- `nums[b] = d`

也就是：`a -> d` 且 `b -> d`，于是进入 `d` 后的路径会合流并形成环。
Floyd 判圈算法能找到这个环的入口，而入口就是 `d`。

---

## 案例 1 走一遍：nums = [1,3,4,2,2]（答案 2）

下标和值：

- 0 -> nums[0]=1
- 1 -> nums[1]=3
- 3 -> nums[3]=2
- 2 -> nums[2]=4
- 4 -> nums[4]=2

从 0 出发路径：

```text
0 -> 1 -> 3 -> 2 -> 4 -> 2 -> 4 -> 2 ...
```

环是：`2 -> 4 -> 2`
环入口：`2` ✅ 就是重复数。

---

## 解法步骤（Floyd 快慢指针）

### 第一阶段：找相遇点（证明存在环）

- 慢指针：一次走 1 步 `slow = nums[slow]`
- 快指针：一次走 2 步 `fast = nums[nums[fast]]`
  它们一定会在环内相遇。

### 第二阶段：找环入口（重复数）

- 让一个指针回到起点 `0`
- 两个指针每次都走 1 步
- 它们再次相遇的位置就是环入口（重复数）

---

## 代码（JS，原地不改数组 + 详细注释）

```js
/**
 * @param {number[]} nums
 * @return {number}
 */
var findDuplicate = function (nums) {
  // ====== 第一阶段：找快慢指针相遇点（环内相遇）======
  let slow = 0;
  let fast = 0;

  do {
    // slow 走一步
    slow = nums[slow];
    // fast 走两步
    fast = nums[nums[fast]];
  } while (slow !== fast);

  // ====== 第二阶段：找环的入口（入口就是重复数字）======
  // 把其中一个指针移回起点 0
  let ptr1 = 0;
  let ptr2 = slow; // 或 fast，都在相遇点

  // 两者每次都走一步，相遇点就是环入口
  while (ptr1 !== ptr2) {
    ptr1 = nums[ptr1];
    ptr2 = nums[ptr2];
  }

  return ptr1; // 或 ptr2
};
```

---

## 再用示例 2 快速验证：nums = [3,1,3,4,2]

从 0 出发：

```text
0 -> 3 -> 4 -> 2 -> 3 -> 4 -> 2 ...
```

环入口是 `3` ✅

---

## 复杂度

- 时间：`O(n)`
- 额外空间：`O(1)`
- 不修改数组：✅

---

如果你还想要另一种同样满足条件的解法（**二分计数法**，也是 O(1) 空间但 O(n log n) 时间），我也可以给你对比讲解。
