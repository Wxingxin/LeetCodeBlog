# ä»å‰åºä¸ä¸­åºéå†åºåˆ—æ„é€ äºŒå‰æ ‘

ç»™å®šä¸¤ä¸ªæ•´æ•°æ•°ç»„ `preorder` å’Œ `inorder` ï¼Œ

å…¶ä¸­ `preorder` æ˜¯äºŒå‰æ ‘çš„å…ˆåºéå†ï¼Œ `inorder` æ˜¯åŒä¸€æ£µæ ‘çš„ä¸­åºéå†ï¼Œ

è¯·æ„é€ äºŒå‰æ ‘å¹¶è¿”å›å…¶æ ¹èŠ‚ç‚¹ã€‚

 

## ç¤ºä¾‹ 1:
![](./img3/b1.png)


è¾“å…¥: `preorder = [3,9,20,15,7], inorder = [9,3,15,20,7]`

è¾“å‡º: `[3,9,20,null,null,15,7]`

## ç¤ºä¾‹ 2:

è¾“å…¥: `preorder = [-1], inorder = [-1]`

è¾“å‡º: `[-1]`

# é¢˜è§£

## æ€è·¯

## code
```js
/**
 * äºŒå‰æ ‘èŠ‚ç‚¹å®šä¹‰
 * function TreeNode(val, left, right) {
 *     this.val = (val===undefined ? 0 : val)
 *     this.left = (left===undefined ? null : left)
 *     this.right = (right===undefined ? null : right)
 * }
 */

/**
 * æ ¹æ®å…ˆåºéå†å’Œä¸­åºéå†æ„å»ºäºŒå‰æ ‘
 * @param {number[]} preorder å…ˆåºéå†æ•°ç»„
 * @param {number[]} inorder  ä¸­åºéå†æ•°ç»„
 * @return {TreeNode}         æ„å»ºå¥½çš„äºŒå‰æ ‘æ ¹èŠ‚ç‚¹
 */
```

```js
var buildTree = function(preorder, inorder) {

  // 1. ç”¨å“ˆå¸Œè¡¨è®°å½•ä¸­åºéå†ä¸­æ¯ä¸ªå€¼çš„ä½ç½®ã€‚æ–¹ä¾¿ O(1) æ‰¾åˆ°æ ¹èŠ‚ç‚¹åœ¨ä¸­åºæ•°ç»„ä¸­çš„ç´¢å¼•
  const indexMap = new Map();
  for (let i = 0; i < inorder.length; i++) {
    indexMap.set(inorder[i], i);
  }

  // 2. å…ˆåºéå†çš„æŒ‡é’ˆï¼Œå§‹ç»ˆæŒ‡å‘å½“å‰å­æ ‘çš„æ ¹èŠ‚ç‚¹
  let preIdx = 0;

  /**
   * é€’å½’å‡½æ•°ï¼šæ ¹æ® inorder çš„å·¦å³è¾¹ç•Œæ„å»ºå­æ ‘
   * @param {number} inL å½“å‰å­æ ‘åœ¨ inorder ä¸­çš„å·¦è¾¹ç•Œ
   * @param {number} inR å½“å‰å­æ ‘åœ¨ inorder ä¸­çš„å³è¾¹ç•Œ
   */
  function helper(inL, inR) {
    // 3. è¾¹ç•Œæ¡ä»¶ï¼šåŒºé—´ä¸ºç©ºï¼Œè¯´æ˜æ²¡æœ‰èŠ‚ç‚¹
    if (inL > inR) return null;

    // 4. ä»å…ˆåºéå†ä¸­å–å½“å‰å­æ ‘çš„æ ¹èŠ‚ç‚¹å€¼
    const rootVal = preorder[preIdx++];
    const root = new TreeNode(rootVal);

    // 5. æ‰¾åˆ°æ ¹èŠ‚ç‚¹åœ¨ä¸­åºéå†ä¸­çš„ä½ç½®
    const mid = indexMap.get(rootVal);

    // 6. ä¸­åºéå†ä¸­ï¼š ï¼ˆå·¦è¾¹ [inL, mid-1] æ˜¯å·¦å­æ ‘ï¼‰ï¼ˆå³è¾¹ [mid+1, inR] æ˜¯å³å­æ ‘ï¼‰
    root.left = helper(inL, mid - 1);
    root.right = helper(mid + 1, inR);

    // 7. è¿”å›å½“å‰å­æ ‘çš„æ ¹
    return root;
  }

  // 8. ä»æ•´ä¸ªä¸­åºåŒºé—´å¼€å§‹æ„å»º
  return helper(0, inorder.length - 1);
};

```

ç›´æ¥æ‹¿ä½ è¿™æ®µä»£ç ï¼Œå¸¦ç€ä¾‹å­
`preorder = [3,9,20,15,7]`
`inorder  = [9,3,15,20,7]`
ä¸€æ­¥ä¸€æ­¥è·‘ä¸€é ğŸ‘‡

---

## 1âƒ£ å‰ç½®å‡†å¤‡ï¼šindexMap

```js
const indexMap = new Map();
for (let i = 0; i < inorder.length; i++) {
    indexMap.set(inorder[i], i);
}
```

éå† `inorder = [9,3,15,20,7]`ï¼Œå¾—åˆ°ï¼š

```txt
å€¼ -> ä¸­åºä¸‹æ ‡
9  -> 0
3  -> 1
15 -> 2
20 -> 3
7  -> 4
```

ä¹Ÿå°±æ˜¯ï¼š

```js
indexMap.get(3)  === 1
indexMap.get(9)  === 0
indexMap.get(15) === 2
indexMap.get(20) === 3
indexMap.get(7)  === 4
```

è¿™ä¸ªè¡¨ç”¨æ¥ï¼š**O(1) æ‰¾åˆ°æŸä¸ªå€¼åœ¨ä¸­åºéå†ä¸­çš„ä½ç½®**ã€‚

---

## 2âƒ£ ç¬¬ä¸€æ¬¡é€’å½’ï¼šæ•´æ£µæ ‘

è°ƒç”¨ï¼š

```js
build(0, 4, 0, 4)
```

* `preL = 0, preR = 4`ï¼Œè¡¨ç¤ºå…ˆåºç”¨çš„æ˜¯ `preorder[0..4]` â†’ `[3,9,20,15,7]`
* `inL  = 0, inR  = 4`ï¼Œè¡¨ç¤ºä¸­åºç”¨çš„æ˜¯ `inorder[0..4]` â†’ `[9,3,15,20,7]`

### 2.1 ç¡®å®šæ ¹èŠ‚ç‚¹

```js
const rootVal = preorder[preL]; // preorder[0] = 3
const root = new TreeNode(3);
```

æ‰€ä»¥å½“å‰å­æ ‘ï¼ˆæ•´ä¸ªæ ‘ï¼‰çš„æ ¹æ˜¯ `3`ã€‚

### 2.2 åœ¨ä¸­åºä¸­æ‰¾ 3 çš„ä½ç½®

```js
const k = indexMap.get(rootVal); // indexMap.get(3) = 1
```

ä¸­åºæ•°ç»„ï¼š[9, 3, 15, 20, 7]
ç´¢å¼•ï¼š    [0, 1,  2,  3,  4]

`3` åœ¨ä¸­åºé‡Œçš„ä½ç½®æ˜¯ `1`ï¼Œæ‰€ä»¥ï¼š

* ä¸­åºå·¦è¾¹ `[0..0]` â†’ `[9]` æ˜¯å·¦å­æ ‘
* ä¸­åºå³è¾¹ `[2..4]` â†’ `[15,20,7]` æ˜¯å³å­æ ‘

å·¦å­æ ‘çš„èŠ‚ç‚¹æ•°ï¼š

```js
const leftSize = k - inL; // 1 - 0 = 1
```

### 2.3 åˆ’åˆ†å·¦å³å­æ ‘çš„å…ˆåºåŒºé—´

å·¦å­æ ‘æœ‰ `1` ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥åœ¨å…ˆåºä¸­ï¼š

* æ ¹æ˜¯ `preL = 0` ä½ç½®ï¼ˆå·²ç»ç”¨æ‰ï¼‰
* å·¦å­æ ‘å…ˆåºåŒºé—´æ˜¯ `[preL + 1 .. preL + leftSize]`

  * `[1 .. 1]` â†’ `[9]`
* å³å­æ ‘å…ˆåºåŒºé—´æ˜¯ `[preL + leftSize + 1 .. preR]`

  * `[2 .. 4]` â†’ `[20,15,7]`

æ‰€ä»¥æ¥ä¸‹æ¥ï¼š

```js
root.left  = build(1, 1, 0, 0); // å·¦å­æ ‘
root.right = build(2, 4, 2, 4); // å³å­æ ‘
```

å½“å‰ç»“æœæ ‘åªæ˜¯ï¼š

```txt
  3
 / \
?   ?
```

---

## 3âƒ£ æ„å»ºå·¦å­æ ‘ï¼šbuild(1,1,0,0)

å…ˆåº `[1..1]` â†’ `[9]`
ä¸­åº `[0..0]` â†’ `[9]`

```js
const rootVal = preorder[1]; // 9
const root = new TreeNode(9);

const k = indexMap.get(9);  // 0
const leftSize = k - inL;   // 0 - 0 = 0
```

* å·¦å­æ ‘èŠ‚ç‚¹æ•° = 0
* ä¸­åºï¼šå·¦å­æ ‘åŒºé—´ `[inL .. k-1] = [0 .. -1]`ï¼ˆç©ºï¼‰
* ä¸­åºï¼šå³å­æ ‘åŒºé—´ `[k+1 .. inR] = [1 .. 0]`ï¼ˆç©ºï¼‰
* å…ˆåºï¼šå·¦å­æ ‘ `[preL+1 .. preL+leftSize] = [2 .. 1]`ï¼ˆç©ºï¼‰
* å…ˆåºï¼šå³å­æ ‘ `[preL+leftSize+1 .. preR] = [2 .. 1]`ï¼ˆç©ºï¼‰

æ‰€ä»¥ï¼š

```js
root.left  = build(2, 1, 0, -1); // è¿”å› null
root.right = build(2, 1, 1,  0); // è¿”å› null
```

å¾—åˆ°å·¦å­æ ‘å°±æ˜¯å•èŠ‚ç‚¹ `9`ï¼š

```txt
9
```

å›åˆ°ä¸Šä¸€å±‚ï¼Œæ•´æ£µæ ‘ç°åœ¨é•¿è¿™æ ·ï¼š

```txt
   3
  /
 9
```

---

## 4âƒ£ æ„å»ºå³å­æ ‘ï¼šbuild(2,4,2,4)

å…ˆåº `[2..4]` â†’ `[20,15,7]`
ä¸­åº `[2..4]` â†’ `[15,20,7]`

```js
const rootVal = preorder[2]; // 20
const root = new TreeNode(20);

const k = indexMap.get(20); // 3
const leftSize = k - inL;   // 3 - 2 = 1
```

æ‰€ä»¥ä»¥ `20` ä¸ºæ ¹ï¼š

* ä¸­åºå·¦å­æ ‘ `[inL .. k-1] = [2 .. 2]` â†’ `[15]`
* ä¸­åºå³å­æ ‘ `[k+1 .. inR] = [4 .. 4]` â†’ `[7]`

å·¦å­æ ‘èŠ‚ç‚¹æ•° `leftSize = 1`ï¼Œäºæ˜¯ï¼š

* å·¦å­æ ‘å…ˆåº `[preL+1 .. preL+leftSize] = [3 .. 3]` â†’ `[15]`
* å³å­æ ‘å…ˆåº `[preL+leftSize+1 .. preR] = [4 .. 4]` â†’ `[7]`

æ¥ä¸‹æ¥è°ƒç”¨ï¼š

```js
root.left  = build(3, 3, 2, 2); // æ„å»º 20 çš„å·¦å­æ ‘
root.right = build(4, 4, 4, 4); // æ„å»º 20 çš„å³å­æ ‘
```

æ­¤æ—¶å³å­æ ‘ç»“æ„ï¼š

```txt
  20
 /  \
?    ?
```

---

## 5âƒ£ æ„å»º 20 çš„å·¦å­æ ‘ï¼šbuild(3,3,2,2)

å…ˆåº `[3..3]` â†’ `[15]`
ä¸­åº `[2..2]` â†’ `[15]`

```js
const rootVal = preorder[3]; // 15
const root = new TreeNode(15);

const k = indexMap.get(15); // 2
const leftSize = k - inL;   // 2 - 2 = 0
```

å·¦å³å­æ ‘åŒºé—´éƒ½ä¸ºç©ºï¼Œé€’å½’éƒ½ä¼šç›´æ¥è¿”å› `null`ï¼š

```js
root.left  = build(4, 3, 2, 1); // null
root.right = build(4, 3, 3, 2); // null
```

å¾—åˆ°ï¼š

```txt
15
```

---

## 6âƒ£ æ„å»º 20 çš„å³å­æ ‘ï¼šbuild(4,4,4,4)

å…ˆåº `[4..4]` â†’ `[7]`
ä¸­åº `[4..4]` â†’ `[7]`

åŒæ ·æ˜¯å¶å­èŠ‚ç‚¹ï¼š

```js
const rootVal = preorder[4]; // 7
const root = new TreeNode(7);

const k = indexMap.get(7); // 4
const leftSize = k - inL;  // 4 - 4 = 0

root.left  = build(5, 4, 4, 3); // null
root.right = build(5, 4, 5, 4); // null
```

å¾—åˆ°ï¼š

```txt
7
```

---

## 7âƒ£ å›æº¯ç»„è£…æ•´æ£µæ ‘

ä»ä¸‹å¾€ä¸Šæ‹¼å›å»ï¼š

1. `build(3,3,2,2)` è¿”å›èŠ‚ç‚¹ `15`
2. `build(4,4,4,4)` è¿”å›èŠ‚ç‚¹ `7`
3. ä»¥ `20` ä¸ºæ ¹ï¼š

```txt
  20
 /  \
15   7
```

4. å·¦å­æ ‘ `9`ï¼Œå³å­æ ‘æ˜¯ä¸Šé¢çš„ `20`ï¼š

æ•´æ£µæ ‘ï¼š

```txt
      3
     / \
    9   20
       /  \
      15   7
```

è¿™æ£µæ ‘çš„ï¼š

* å…ˆåºéå†ï¼š`[3, 9, 20, 15, 7]` âœ…ï¼ˆå¯¹åº” `preorder`ï¼‰
* ä¸­åºéå†ï¼š`[9, 3, 15, 20, 7]` âœ…ï¼ˆå¯¹åº” `inorder`ï¼‰

å®Œå…¨ç¬¦åˆé¢˜æ„ã€‚

---

## ğŸ” å°ç»“ä¸€ä¸‹è¿™æ®µä»£ç çš„æ ¸å¿ƒç‚¹

1. **preorder[preL] æ°¸è¿œæ˜¯å½“å‰å­æ ‘çš„æ ¹**ã€‚
2. åœ¨ `inorder` ä¸­æ‰¾åˆ°è¿™ä¸ªæ ¹çš„ä½ç½® `k`ï¼Œæ ¹æ®ä¸‹æ ‡åˆ’åˆ†å‡ºå·¦/å³å­æ ‘çš„ä¸­åºåŒºé—´ã€‚
3. ç”¨ `leftSize = k - inL` å¾—åˆ°å·¦å­æ ‘èŠ‚ç‚¹æ•°é‡ï¼Œå†åœ¨å…ˆåºä¸­åˆ‡å‡ºå·¦/å³å­æ ‘å¯¹åº”çš„åŒºé—´ã€‚
4. é€’å½’æ„é€ å·¦å³å­æ ‘ï¼Œè¿”å›æ ¹èŠ‚ç‚¹ã€‚

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªè¿‡ç¨‹æ”¹å†™æˆå¸¦ã€Œå…¨å±€æŒ‡é’ˆ preIndexã€çš„å¦ä¸€ç§å†™æ³•ï¼Œå†ç”¨åŒæ ·çš„ä¾‹å­å¸®ä½ å¯¹æ¯”ä¸¤ç§å†™æ³•çš„åŒºåˆ«ã€‚
